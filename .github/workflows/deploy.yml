name: Push to Replicate

on:
  workflow_dispatch:
    inputs:
      model_name:
        description: 'erayyavuz/interior-ai'
        required: true

jobs:
  push_to_replicate:
    name: Push to Replicate
    runs-on: ubuntu-latest
    steps:
      # 1. Repository'i Klonla
      - name: Repository'i Klonla
        uses: actions/checkout@v4

      # 2. Python Kurulumu
      - name: Python Kurulumu
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'  # İhtiyacınıza göre Python sürümünü belirleyin

      # 3. Sanal Ortam Oluşturma ve Cog Kurulumu
      - name: Sanal Ortam Oluştur ve Cog Kur
        run: |
          # Sanal ortam oluştur
          python -m venv venv
          
          # Sanal ortamı etkinleştir
          source venv/bin/activate
          
          # pip'i güncelle
          pip install --upgrade pip
          
          # Cog'u sanal ortama kur
          pip install cog
          
          # Kurulumu doğrula
          ls -la venv/bin
          venv/bin/cog --version

      # 4. Replicate’a Push Etme
      - name: Replicate’a Push Et
        run: |
          # Sanal ortamı etkinleştir
          source venv/bin/activate
          
          # Replicate’a push et
          venv/bin/cog push r8.im/${{ inputs.model_name }}
        env:
          REPLICATE_API_TOKEN: ${{ secrets.REPLICATE_API_TOKEN }}
